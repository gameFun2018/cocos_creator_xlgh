require=function i(s,a,r){function l(e,t){if(!a[e]){if(!s[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(u)return u(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var c=a[e]={exports:{}};s[e][0].call(c.exports,function(t){return l(s[e][1][t]||t)},c,c.exports,i,s,a,r)}return a[e].exports}for(var u="function"==typeof require&&require,t=0;t<r.length;t++)l(r[t]);return l}({DataManager:[function(t,e,o){"use strict";cc._RF.push(e,"40045ltXJVKT5IDLvfpJZRA","DataManager"),cc.Class({extends:cc.Component,properties:{CurScore:{default:0,type:cc.Integer},CurGold:{default:0,type:cc.Integer}},start:function(){cc.log("DataManager start")},getCurScore:function(){return this.CurScore},setCurScore:function(t){this.CurScore=t},getCurGold:function(){return this.CurGold},setCurGold:function(t){this.CurGold=t}}),cc._RF.pop()},{}],Game:[function(t,e,o){"use strict";cc._RF.push(e,"3b49b9cEH9FRLyZW0WteHSN","Game"),cc.Class({extends:cc.Component,properties:{UIMgrNode:cc.Node},onLoad:function(){},start:function(){}}),cc._RF.pop()},{}],Player:[function(t,e,o){"use strict";cc._RF.push(e,"e11dcoKmHBHFIO338w4ao7F","Player"),cc.Class({extends:cc.Component,properties:{_UIGameNode:cc.Node},start:function(){this._UIGameNode=cc.find("Canvas/UIManager/UIGame")},jump:function(t){var e=cc.jumpBy(.2,t,80,1),o=cc.callFunc(this.onJumpEnd,this),n=cc.sequence(e,o);0<t.x?this.node.setScaleX(1):this.node.setScaleX(-1),this.node.runAction(n)},onJumpEnd:function(){this._UIGameNode.getComponent("UIGame").onPlayerJumpEnd()}}),cc._RF.pop()},{}],SoundManager:[function(t,e,o){"use strict";cc._RF.push(e,"0fd9cAQtcdG+7PbX8bBx4Ax","SoundManager");var n=t("SoundType");cc.Class({extends:cc.Component,properties:{SoundList:{default:[],type:[cc.AudioClip]},_PlayList:[]},start:function(){this.playSound(n.SoundType_Bg)},playSound:function(t){if(t.ID>=this.SoundList.length)cc.log("playSound resIndex invalid ");else{var e=cc.audioEngine.play(this.SoundList[t.ID],t.IsLoop);this._PlayList[t.ID]=e}},stopSound:function(t){t.ID>=this.SoundList.length?cc.log("playSound resIndex invalid "):-1!=this._PlayList[t.ID]&&cc.audioEngine.stop(this._PlayList[t.ID])}}),cc._RF.pop()},{SoundType:"SoundType"}],SoundType:[function(t,e,o){"use strict";cc._RF.push(e,"d3101dt4dBBUZdG5k7GIEkV","SoundType");e.exports={SoundType_Bg:{ID:0,IsLoop:!0},SoundType_UIClick:{ID:1,IsLoop:!1},SoundType_Enter:{ID:2,IsLoop:!1},SoundType_Fail:{ID:3,IsLoop:!1},SoundType_Move:{ID:4,IsLoop:!1}},cc._RF.pop()},{}],UIGameOver:[function(t,e,o){"use strict";cc._RF.push(e,"3dd483U9ZVGN5zzCmfY6awR","UIGameOver");var n=t("UIType");cc.Class({extends:cc.Component,properties:{ScoreLabel:{default:null,type:cc.Label},GoldLabel:{default:null,type:cc.Label},RelifeBtn:{default:null,type:cc.Button},OkBtn:{default:null,type:cc.Button},_DataManager:cc.Node},onLoad:function(){this._DataManager=cc.find("DataManager")},start:function(){this.RelifeBtn.node.on(cc.Node.EventType.TOUCH_END,this.onRelifeBtn,this),this.OkBtn.node.on(cc.Node.EventType.TOUCH_END,this.onOkBtn,this)},onEnable:function(){var t=this._DataManager.getComponent("DataManager");this.ScoreLabel.string=t.getCurScore().toString(),this.GoldLabel.string=t.getCurGold().toString()},onDisable:function(){},onRelifeBtn:function(t){this._DataManager.getComponent("DataManager").getCurGold();var e=this.node.parent.getComponent("UIManager");e.closeUI(n.UIType_GameOver),e.getUI(n.UIType_Game).reset(),t.stopPropagation()},onOkBtn:function(t){var e=this.node.parent.getComponent("UIManager");e.closeUI(n.UIType_GameOver),e.getUI(n.UIType_Game).reset(),t.stopPropagation()}}),cc._RF.pop()},{UIType:"UIType"}],UIGame:[function(t,e,o){"use strict";cc._RF.push(e,"da6fdAt6k1DQqg7TboDDP5E","UIGame");var i=t("UIType"),s=0,a=1,r=2,l=3,u=4;cc.Class({extends:cc.Component,properties:{StartBtn:{default:null,type:cc.Button},PauseBtn:{default:null,type:cc.Button},Score_OneJump:{default:1,type:cc.Integer},BlockPrefab:cc.Prefab,BlockInitNode:cc.Node,BlockNode:cc.Node,DataMgrNode:cc.Node,PlayerNode:cc.Node,BlockOffVec:cc.v2(150,100),DataManager:cc.Node,_BlockPool:cc.NodePool,_BlockList:[],_BlockListUse:[],_BlockTopPos:cc.v2(0,0),_CurGameState:-1,_CurBlockIndex:0},onLoad:function(){this.DataManager=cc.find("DataManager"),this._BlockPool=new cc.NodePool;for(var t=0;t<30;++t){var e=cc.instantiate(this.BlockPrefab);this.pushBlock(e)}},start:function(){this.StartBtn.node.on(cc.Node.EventType.TOUCH_END,this.onStartBtn,this),this.PauseBtn.node.on(cc.Node.EventType.TOUCH_END,this.onPauseBtn,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onScreenTouch,this);var t=this.initSceneBlock();this._BlockTopPos=t.getChildByName("BlockTop").position,this.initPlayerPos(t),this.setGameState(s),this._CurBlockIndex=0},onStartBtn:function(t){this.setGameState(r),t.stopPropagation()},onPauseBtn:function(){this.setGameState(a),event.stopPropagation()},onScreenTouch:function(t){if(this._CurGameState==r){var e=t.getLocationX();cc.log("touch end",e);var o=1;if(o=360<e?1:-1,this._CurBlockIndex<0||this._CurBlockIndex>=this._BlockListUse.length-1)cc.log("onScreenTouch invalid _CurBlockIndex ",this._CurBlockIndex);else{var n=this._BlockListUse[this._CurBlockIndex+1];if(null!=n){var c=cc.pSub(cc.pAdd(this._BlockTopPos,n.position),this.PlayerNode.position),i=cc.v2(o*Math.abs(c.x),c.y);this.PlayerNode.getComponent("Player").jump(i),this.PlayerNode.setTag(o),i=cc.p(o*this.BlockOffVec.x,this.BlockOffVec.y);var s=cc.moveBy(.2,cc.pMult(i,-1));this.BlockNode.runAction(s),this.setGameState(l)}else cc.log("onScreenTouch invalid nextBlock null",this._CurBlockIndex+1)}}},onPlayerJumpEnd:function(){var t=this._BlockListUse.length,e=this._BlockListUse[t-1].position;(i=this.getBlock()).parent=this.BlockNode,i.scaleY=1;var o=0<=cc.randomMinus1To1()?1:-1,n=cc.v2(this.BlockOffVec.x*o,this.BlockOffVec.y);if(e=cc.pAdd(e,n),i.position=e,this._CurBlockIndex+=1,this._CurBlockIndex<1)cc.log("onPlayerJumpEnd invalid _CurBlockIndex");else{var c=this.PlayerNode.getTag(),i=this._BlockListUse[this._CurBlockIndex],s=this._BlockListUse[this._CurBlockIndex-1];if(0<c&&i.position.x>s.position.x||c<0&&i.position.x<s.position.x){cc.log("right "),this.setGameState(r);var a=this.DataManager.getComponent("DataManager");a.setCurScore(a.getCurScore()+this.Score_OneJump)}else cc.log("wrong "),this.setGameState(u);5<this._CurBlockIndex&&this.delelteUseBlock()}},onBlockDownFinish:function(t){cc.log("onBlockDownFinish",t),0<=this._CurBlockIndex&&this._CurBlockIndex<this._BlockListUse.length&&this._BlockListUse[this._CurBlockIndex]===t&&this._CurGameState==r&&this.setGameState(u)},initSceneBlock:function(){for(var t,e=this.BlockInitNode.parent.convertToWorldSpaceAR(this.BlockInitNode.position),o=this.BlockNode.convertToNodeSpaceAR(e),n=0;n<30;++n){var c=this.getBlock();if(c.parent=this.BlockNode,c.scaleY=1,0==n)c.position=o,t=c;else{var i=0<=cc.randomMinus1To1()?1:-1,s=cc.v2(this.BlockOffVec.x*i,this.BlockOffVec.y);o=cc.pAdd(o,s),c.position=o}}return t},initPlayerPos:function(t){this.PlayerNode.position=cc.pAdd(t.position,this._BlockTopPos),this.PlayerNode.setLocalZOrder(1e5)},getBlock:function(){if(0<this._BlockList.length){var t=this._BlockList.pop();return this._BlockListUse.push(t),t}t=cc.instantiate(this.BlockPrefab);return this.pushBlock(t),this.getBlock()},pushBlock:function(t){this._BlockList.push(t)},delelteUseBlock:function(){var t=this._BlockListUse.shift();t.parent=null,this._BlockList.push(t),this._CurBlockIndex-=1},setGameState:function(t){if(this._CurGameState==a&&t!=this._CurGameState&&cc.director.resume(),this._CurGameState=t,this._CurGameState==s)this.StartBtn.node.active=!0,this.PauseBtn.node.active=!1;else if(this._CurGameState==a)cc.director.pause(),this.StartBtn.node.active=!0,this.PauseBtn.node.active=!1;else if(this._CurGameState==r){if(this.StartBtn.node.active=!1,this.PauseBtn.node.active=!0,this._CurBlockIndex<0||this._CurBlockIndex>=this._BlockListUse.length)return void cc.log("GS_WaitOP invalid _CurBlockIndex ",this._CurBlockIndex);var e=this._BlockListUse[this._CurBlockIndex];if(null==e)return void cc.log("GS_WaitOP invalid curBlock null",this._CurBlockIndex);var o=e.getActionByTag(0);if(null==o){var n=cc.scaleTo(2,1,0),c=cc.callFunc(this.onBlockDownFinish,this,e);o=cc.sequence(n,c),e.runAction(o)}}else if(this._CurGameState==u){this.StartBtn.node.active=!1,this.PauseBtn.node.active=!1,this.node.parent.getComponent("UIManager").openUI(i.UIType_GameOver)}},reset:function(){for(var t=0;t<this._BlockListUse.length;++t){var e=this._BlockListUse[t];this._BlockList.push(e)}this._BlockListUse.splice(0,this._BlockListUse.length),this._CurBlockIndex=0,this.BlockNode.removeAllChildren(),this.PlayerNode.parent=this.BlockNode;var o=this.initSceneBlock();this._BlockTopPos=o.getChildByName("BlockTop").position,this.initPlayerPos(o),this.setGameState(s)},update:function(t){if(this._CurGameState==r){if(this._CurBlockIndex<0||this._CurBlockIndex>=this._BlockListUse.length)return;var e=this._BlockListUse[this._CurBlockIndex];if(null==e)return;var o=cc.pAdd(e.position,cc.p(0,this._BlockTopPos.y*e.scaleY));this.PlayerNode.position=o}}}),cc._RF.pop()},{UIType:"UIType"}],UIManager:[function(t,e,o){"use strict";cc._RF.push(e,"6c56eFkIKVAGruXbQvXYBV9","UIManager");t("UIType");cc.Class({extends:cc.Component,properties:{UIList:{default:[],type:[cc.Node]}},start:function(){},getUIScriptName:function(t){return["UIGame","UIGameOver","UIGame"][t]},openUI:function(t){t>=this.UIList.length?cc.log("openUI invalid uiType, please check UIList"):null!=this.UIList[t]&&null!=this.UIList[t]?this.UIList[t].active=!0:cc.log("openUI invalid uiType, object null")},closeUI:function(t){t>=this.UIList.length?cc.log("closeUI invalid uiType, please check UIList"):this.UIList[t].active=!1},getUI:function(t){if(!(t>=this.UIList.length))return this.UIList[t].getComponent(this.getUIScriptName(t));cc.log("closeUI invalid uiType, please check UIList")}}),cc._RF.pop()},{UIType:"UIType"}],UIType:[function(t,e,o){"use strict";cc._RF.push(e,"91b1bYsK1ZOVLnNBkOd9lOU","UIType");e.exports={UIType_Game:0,UIType_GameOver:1,UIType_Rank:2},cc._RF.pop()},{}]},{},["DataManager","Game","Player","SoundManager","SoundType","UIGame","UIGameOver","UIManager","UIType"]);
//# sourceMappingURL=project.js.map